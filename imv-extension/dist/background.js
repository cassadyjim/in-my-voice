(()=>{"use strict";chrome.runtime.onMessage.addListener((e,t,s)=>(async function(e){try{switch(e.type){case"GET_PROMPT":{const e=await chrome.storage.local.get(["cachedPrompt","promptVersion","lastSync"]);return e.cachedPrompt?{success:!0,data:{text:e.cachedPrompt,version:e.promptVersion||1,lastSync:e.lastSync}}:{success:!1,error:"No prompt cached. Please open the extension popup to sync."}}case"CHECK_AUTH":return{success:!0,data:{isLoggedIn:!!(await chrome.storage.local.get(["sb-jpfillyapcxylcogirxq-auth-token"]))["sb-jpfillyapcxylcogirxq-auth-token"]}};default:return{success:!1,error:"Unknown message type"}}}catch(e){return{success:!1,error:e.message}}}(e).then(s),!0)),chrome.runtime.onInstalled.addListener(e=>{"install"===e.reason&&console.log("IMV Extension installed! Click the extension icon to log in.")}),chrome.storage.onChanged.addListener((e,t)=>{"local"===t&&e.cachedPrompt&&chrome.tabs.query({},e=>{e.forEach(e=>{e.id&&e.url?.includes("chat.openai.com")&&chrome.tabs.sendMessage(e.id,{type:"PROMPT_UPDATED"}).catch(()=>{})})})})})();
(()=>{"use strict";let e=null,t=!1;async function n(){try{const t=await chrome.runtime.sendMessage({type:"GET_PROMPT"});t?.success&&t.data?.text&&(e=t.data.text,console.log("IMV: Prompt loaded (v"+t.data.version+")"))}catch(e){console.error("IMV: Failed to load prompt",e)}}function o(){const e=["#prompt-textarea",'textarea[data-id="root"]','textarea[placeholder*="Message"]','div[contenteditable="true"][data-placeholder]',".ProseMirror"];for(const t of e){const e=document.querySelector(t);if(e)return e}return null}function s(){if(document.querySelector(".imv-inject-btn"))return;const e=o();if(!e)return;const n=e.closest("form")||e.parentElement?.parentElement;if(!n)return;const s=document.createElement("button");s.className="imv-inject-btn",s.innerHTML='\n    <span class="imv-icon">ðŸŽ¤</span>\n    <span class="imv-text">Add IMV</span>\n  ',s.title="Insert your In My Voice prompt",s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),r()});const i=n.querySelector('button[data-testid="send-button"]')||n.querySelector('button[aria-label*="Send"]')||n.querySelector("button:last-of-type");i&&i.parentElement?i.parentElement.insertBefore(s,i):(s.classList.add("imv-floating"),document.body.appendChild(s)),t=!0,console.log("IMV: Button injected")}function r(){if(!e)return void i("No IMV prompt found. Please sync in the extension popup.","error");const t=o();if(!t)return void i("Could not find ChatGPT input. Please refresh the page.","error");const n=`${e}\n\n---\n\nNow, please respond to my next message using the voice profile above. Here's my request:\n\n`;if(t instanceof HTMLTextAreaElement){const e=t.value;t.value=n+e,t.dispatchEvent(new Event("input",{bubbles:!0}))}else{const e=t.innerHTML;t.innerHTML=n.replace(/\n/g,"<br>")+e,t.dispatchEvent(new Event("input",{bubbles:!0}))}t.focus(),i("IMV prompt added! Type your message below the line.","success");const s=document.querySelector(".imv-inject-btn");if(s){s.classList.add("imv-used");const e=s.querySelector(".imv-text");e&&(e.textContent="Added âœ“")}}function i(e,t){document.querySelectorAll(".imv-notification").forEach(e=>e.remove());const n=document.createElement("div");n.className=`imv-notification imv-notification-${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.classList.add("imv-notification-hide"),setTimeout(()=>n.remove(),300)},3e3)}chrome.runtime.onMessage.addListener((e,t,o)=>"PROMPT_UPDATED"===e.type?(n().then(()=>{o({success:!0})}),!0):"INJECT_NOW"===e.type?(r(),o({success:!0}),!0):void 0),async function(){console.log("IMV: Content script loaded"),await n(),new MutationObserver(()=>{o()&&!document.querySelector(".imv-inject-btn")&&s()}).observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{s()},1e3)}()})();